<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨æ–‡ä»¶ä¼ è¾“</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        /* --- æ ‡ç­¾é¡µä¼˜åŒ– (å·¦æ»‘æ•ˆæœ) --- */
        .tab-container {
            margin: 20px -20px; /* è´Ÿè¾¹è·è®©æ»šåŠ¨åŒºåŸŸè´´è¾¹ */
            padding: 0 20px; /* è¡¥å›å†…è¾¹è· */
            border-bottom: 1px solid #eee;

            /* Flexå¸ƒå±€ + æ¨ªå‘æ»šåŠ¨ */
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch; /* iOS æƒ¯æ€§æ»šåŠ¨ */

            /* éšè—æ»šåŠ¨æ¡ */
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tab-container::-webkit-scrollbar {
            display: none;
        }

        .tab {
            display: block;
            flex-shrink: 0; /* ç¦æ­¢å‹ç¼© */
            padding: 12px 20px;
            cursor: pointer;
            border: 1px solid transparent; /* é¢„ç•™è¾¹æ¡†ä½ç½® */
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            background-color: transparent;
            color: #666;
            font-size: 15px;
            transition: all 0.3s;
        }

        .tab.active {
            background-color: white;
            color: #4CAF50;
            font-weight: 600;
            border: 1px solid #eee;
            border-bottom-color: white; /* é®ä½åº•ä¸‹çš„çº¿ */
            position: relative;
            bottom: -1px; /* å‘ä¸‹è¦†ç›–1px */
        }

        .tab-content {
            display: none;
            padding: 15px 0;
        }

        .tab-content.active {
            display: block;
        }

        /* --- é†’ç›®çš„æ–‡ä»¶ä¸Šä¼ åŒº (å¤§è™šçº¿æ¡†é£æ ¼) --- */
        .file-input {
            margin: 25px 0;
            position: relative;
        }

        /* å°†åŸæœ¬å•è–„çš„è¾“å…¥æ¡†ï¼Œæ”¹æˆå¤§å·è§¦æ§åŒº */
        input[type="file"] {
            width: 100%;
            padding: 40px 20px; /* å¤§å¹…å¢åŠ å†…è¾¹è·ï¼Œæ’‘é«˜åŒºåŸŸ */
            border: 2px dashed #4CAF50; /* ç»¿è‰²è™šçº¿è¾¹æ¡† */
            border-radius: 12px;
            background-color: #f1f8e9; /* ææµ…ç»¿è‰²èƒŒæ™¯ */
            color: #2e7d32; /* æ·±ç»¿è‰²æ–‡å­— */
            font-size: 16px; /* å­—ä½“æ”¾å¤§ */
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            box-sizing: border-box;
            transition: all 0.3s ease;
            outline: none;
        }

        /* é¼ æ ‡æ‚¬åœæ—¶çš„æ•ˆæœ */
        input[type="file"]:hover {
            background-color: #e8f5e9; /* èƒŒæ™¯å˜æ·±ä¸€ç‚¹ */
            border-color: #2e7d32; /* è¾¹æ¡†å˜æ·±è‰²å®çº¿æˆ–æ·±è‰²è™šçº¿ */
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15); /* åŠ ä¸€ç‚¹å…‰æ™• */
        }

        /* --- é€šç”¨æŒ‰é’®åŸºç¡€æ ·å¼ --- */
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        button:hover {
            background-color: #45a049;
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            background-color: #cccccc !important;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
            background: #bdbdbd !important;
        }

        /* --- å¼ºåŠ›è¡ŒåŠ¨æŒ‰é’® (å¼€å§‹ä¸Šä¼ ) - ç‰¹åˆ«å®šåˆ¶ --- */
        #uploadBtn {
            display: block;
            width: 100%;
            padding: 16px; /* å¢åŠ é«˜åº¦ */

            /* æ¼‚äº®çš„æ·±ç»¿è‰²æ¸å˜ï¼Œå¾ˆæœ‰æ·±åº¦ */
            background: linear-gradient(135deg, #43a047, #2e7d32);

            color: white;
            border: none;
            border-radius: 50px; /* æ”¹æˆåœ†æ¶¦çš„èƒ¶å›Šå½¢çŠ¶ */
            font-size: 18px; /* å­—å·åŠ å¤§ */
            font-weight: bold; /* å­—ä½“åŠ ç²— */
            letter-spacing: 1px; /* å¢åŠ å­—é—´è· */
            cursor: pointer;

            /* å…³é”®ï¼šå¼ºçƒˆçš„æŠ•å½±ï¼Œè®©å®ƒæµ®èµ·æ¥ */
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);

            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            margin-top: 20px;
        }

        #uploadBtn:hover {
            /* æ‚¬åœæ—¶ä¸Šæµ®å¹¶å˜äº® */
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 25px rgba(46, 125, 50, 0.5);
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }

        #uploadBtn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(46, 125, 50, 0.3);
        }

        /* --- è¿›åº¦æ¡ä¸çŠ¶æ€ --- */
        .progress {
            margin: 15px 0;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
            text-align: center;
            color: white;
            font-size: 12px;
            line-height: 20px;
        }

        .success {
            margin: 10px 0;
            padding: 15px;
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
        }

        .error {
            margin: 10px 0;
            padding: 15px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
        }

        .info {
            margin: 10px 0;
            padding: 15px;
            background-color: #e3f2fd;
            color: #0d47a1;
            border: 1px solid #bbdefb;
            border-radius: 8px;
        }

        .status {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            color: #495057;
            border-radius: 6px;
            font-size: 14px;
        }

        /* --- æ–‡ä»¶åˆ—è¡¨æ ·å¼ --- */
        .file-list {
            margin: 15px 0;
        }

        .file-item, .upload-file-item {
            margin: 8px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-item-info {
            flex: 1;
            min-width: 0; /* é˜²æ­¢æ–‡æœ¬æº¢å‡ºæ’‘å¼€ */
            margin-right: 10px;
        }

        .file-item-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-item-meta {
            font-size: 12px;
            color: #888;
        }

        /* --- ä¼˜åŒ–åçš„æŒ‰é’®ç»„å®¹å™¨ --- */
        .file-item-action {
            display: flex;
            align-items: center;
            gap: 8px; /* æŒ‰é’®ä¹‹é—´ç•™å‡ºå‘¼å¸æ„Ÿ */
            flex-shrink: 0;
        }

        /* --- æŒ‰é’®é€šç”¨åŸºç¡€æ ·å¼ (æ·±è‰²åº•+ç™½å­—) --- */
        .download-btn, .preview-btn, .delete-btn {
            width: auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 14px; /* å®½åº¦é€‚ä¸­ï¼Œé«˜åº¦ç²¾è‡´ */
            font-size: 13px; /* å­—å·æ¸…æ™° */
            border-radius: 6px; /* ç°ä»£çš„å°åœ†è§’ */
            border: none; /* æ— è¾¹æ¡† */
            color: white; /* âš ï¸ æ ¸å¿ƒï¼šç™½è‰²æ–‡å­— */
            font-weight: 500; /* å­—ä½“ç¨å¾®åŠ ç²—ä¸€ç‚¹ç‚¹ */
            cursor: pointer;
            line-height: 1.4;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* åŠ ä¸€ç‚¹è½»å¾®æŠ•å½±ï¼Œå¢åŠ ç«‹ä½“æ„Ÿ */
        }

        /* é¼ æ ‡æ‚¬åœæ—¶çš„é€šç”¨æ•ˆæœï¼šè½»å¾®ä¸Šæµ®+é˜´å½±åŠ æ·± */
        .download-btn:hover, .preview-btn:hover, .delete-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            opacity: 0.95;
        }

        /* é¼ æ ‡ç‚¹å‡»æ—¶çš„æ•ˆæœ */
        .download-btn:active, .preview-btn:active, .delete-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* é¢„è§ˆï¼šä¼˜é›…çš„æ·±ç´«è‰² */
        .preview-btn {
            background: linear-gradient(135deg, #ab47bc, #8e24aa); /* å¾®å¼±æ¸å˜å¢åŠ è´¨æ„Ÿ */
        }

        /* ä¸‹è½½ï¼šç¨³é‡çš„æ·±è“è‰² */
        .download-btn {
            background: linear-gradient(135deg, #42a5f5, #1976d2);
        }

        /* åˆ é™¤ï¼šè­¦ç¤ºçš„æ·±çº¢è‰² */
        .delete-btn {
            background: linear-gradient(135deg, #ef5350, #d32f2f);
        }

        .refresh-btn {
            background-color: #ff9800;
            display: block;
            width: fit-content;
            margin: 0 auto 15px auto;
            padding: 8px 20px;
            color: white;
        }

        .refresh-btn:hover {
            background-color: #f57c00;
        }

        .file-progress {
            margin-top: 8px;
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .file-progress-bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }

        .processing-text {
            font-style: italic;
            color: #666;
            margin-top: 5px;
            font-size: 13px;
        }

        /* --- é¢„è§ˆå¼¹çª—ç¾åŒ– --- */
        .file-item-preview {
            margin-top: 15px;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .file-item-preview .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            padding-right: 30px; /* ç»™å…³é—­æŒ‰é’®ç•™ç©º */
            border-bottom: 1px solid #f0f0f0;
        }

        .preview-title {
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }

        /* é¢„è§ˆå†…å®¹åŒºåŸŸ */
        .file-item-preview .preview-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #444;
            background-color: #fcfcfc;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #f0f0f0;
            max-height: 400px;
            overflow-y: auto;
        }

        /* ç°ä»£åŒ–çš„å…³é—­æŒ‰é’® (ç°è‰² X) */
        .preview-close {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: transparent;
            color: #999;
            border: none;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 24px;
            line-height: 1;
            font-weight: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: none;
            border-radius: 4px;
            z-index: 10;
        }

        .preview-close:hover {
            background-color: #f5f5f5;
            color: #333;
            transform: none;
        }

        /* ç°ä»£åŒ–çš„å¤åˆ¶æŒ‰é’® (èƒ¶å›ŠçŠ¶) */
        .preview-copy {
            background-color: #e8f5e9;
            color: #4CAF50;
            border: 1px solid #a5d6a7;
            border-radius: 20px;
            padding: 5px 14px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.2s;
            box-shadow: none;
            width: auto;
        }

        .preview-copy:hover {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
            transform: translateY(-1px);
        }

        .preview-loading {
            text-align: center;
            padding: 20px;
            color: #888;
            font-style: italic;
        }

        /* --- Toast æç¤º --- */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #323232;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            pointer-events: none;
            font-size: 14px;
            max-width: 300px;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background-color: #4CAF50;
        }

        .toast.error {
            background-color: #f44336;
        }

        .toast.info {
            background-color: #2196F3;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>å®‰å…¨æ–‡ä»¶ä¼ è¾“</h1>
    <div class="info">
        <p>é€‰æ‹©è¦å‘é€çš„æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€‚</p>
    </div>

    <div class="tab-container">
        <div class="tab active" onclick="switchTab('upload')">ä¸Šä¼ æ–‡ä»¶</div>
        <div class="tab" onclick="switchTab('download')">å…±äº«æ–‡ä»¶</div>
        <div class="tab" onclick="switchTab('text')">æ–‡æœ¬ä¼ è¾“</div>
    </div>

    <div id="upload" class="tab-content active">
        <div class="file-input">
            <input type="file" id="fileInput" name="file" multiple>
        </div>

        <button id="uploadBtn" onclick="uploadFiles()">å¼€å§‹ä¸Šä¼ </button>

        <div id="status" class="status" style="display: none;"></div>

        <div id="processingText" class="processing-text" style="display: none;">æœåŠ¡å™¨æ­£åœ¨å¤„ç†æ–‡ä»¶ï¼Œè¯·ç¨å€™...</div>

        <div id="fileList" class="file-list"></div>

        <div id="result"></div>

        <div style="margin-top: 30px;">
            <h3 style="font-size: 16px; color: #333; margin-bottom: 10px;">ğŸ“ å·²ä¸Šä¼ çš„æ–‡ä»¶</h3>
            <button class="refresh-btn" onclick="loadReceivedFiles()">åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</button>
            <div id="receivedFileList" class="file-list" style="max-height: 600px; overflow-y: auto;"></div>
        </div>
    </div>

    <div id="download" class="tab-content">
        <button class="refresh-btn" onclick="loadSharedFiles()">åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</button>

        <div id="downloadStatus" class="status" style="display: none;"></div>

        <div id="sharedFileList" class="file-list"></div>

        <div id="downloadResult"></div>
    </div>

    <div id="toast" class="toast"></div>

    <div id="text" class="tab-content">
        <div class="info">
            <p>ğŸ“‹ åœ¨ä¸‹æ–¹è¾“å…¥æˆ–ç²˜è´´æ–‡æœ¬ï¼Œç‚¹å‡»ä¸Šä¼ åä¼šè‡ªåŠ¨ä¿å­˜ä¸º .txt æ–‡ä»¶åˆ°å…±äº«ç›®å½•</p>
        </div>

        <textarea id="textInput" placeholder="åœ¨æ­¤ç²˜è´´æˆ–è¾“å…¥ä½ çš„æ–‡æœ¬å†…å®¹..."
                  style="width: 100%; min-height: 300px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif; resize: vertical; box-sizing: border-box;"></textarea>

        <div style="margin: 15px 0;">
            <label for="textFileName" style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;">æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" id="textFileName" placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³å‘½å"
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
            <small style="color: #888; font-size: 12px; margin-top: 4px; display: block;">æ–‡ä»¶å°†è‡ªåŠ¨æ·»åŠ  .txt
                åç¼€</small>
        </div>

        <button id="uploadTextBtn" onclick="uploadText()">ä¸Šä¼ æ–‡æœ¬</button>

        <div id="textStatus" class="status" style="display: none;"></div>

        <div id="textResult"></div>
    </div>
</div>

<script>
    // è·å–DOMå…ƒç´ 
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const statusDiv = document.getElementById('status');
    const processingText = document.getElementById('processingText');
    const fileListDiv = document.getElementById('fileList');
    const resultDiv = document.getElementById('result');
    const downloadStatusDiv = document.getElementById('downloadStatus');
    const sharedFileListDiv = document.getElementById('sharedFileList');
    const downloadResultDiv = document.getElementById('downloadResult');
    const textInput = document.getElementById('textInput');
    const textFileName = document.getElementById('textFileName');
    const uploadTextBtn = document.getElementById('uploadTextBtn');
    const textStatusDiv = document.getElementById('textStatus');
    const textResultDiv = document.getElementById('textResult');

    // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
    function showStatus(message, elementId = 'status') {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.style.display = 'block';
    }

    // éšè—çŠ¶æ€ä¿¡æ¯
    function hideStatus(elementId = 'status') {
        const element = document.getElementById(elementId);
        element.style.display = 'none';
    }

    // æ˜¾ç¤ºç»“æœ
    function showResult(message, type, elementId = 'result') {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="${type}">${message}</div>`;
    }

    // æ˜¾ç¤º Toast æç¤º
    function showToast(message, type = 'success', duration = 2000) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type}`;

        // æ˜¾ç¤º Toast
        setTimeout(() => {
            toast.classList.add('show');
        }, 10);

        // è‡ªåŠ¨éšè—
        setTimeout(() => {
            toast.classList.remove('show');
        }, duration);
    }

    // æ ‡ç­¾é¡µåˆ‡æ¢
    function switchTab(tabName) {
        // ç§»é™¤æ‰€æœ‰æ ‡ç­¾é¡µçš„activeç±»
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => tab.classList.remove('active'));

        // ç§»é™¤æ‰€æœ‰å†…å®¹çš„activeç±»
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(content => content.classList.remove('active'));

        // æ·»åŠ å½“å‰æ ‡ç­¾é¡µçš„activeç±»
        document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
        document.getElementById(tabName).classList.add('active');

        // å¦‚æœåˆ‡æ¢åˆ°ä¸‹è½½æ ‡ç­¾ï¼Œè‡ªåŠ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨
        if (tabName === 'download') {
            loadSharedFiles();
        }
    }

    // æ›´æ–°å•ä¸ªæ–‡ä»¶è¿›åº¦æ¡
    function updateFileProgress(fileId, percent) {
        const fileProgressBar = document.getElementById(`fileProgress-${fileId}`);
        if (fileProgressBar) {
            fileProgressBar.style.width = percent + '%';
        }
    }

    // åˆ›å»ºæ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
    function createFileList(files) {
        fileListDiv.innerHTML = '';
        for (let i = 0; i < files.length; i++) {
            const fileItem = document.createElement('div');
            fileItem.className = 'upload-file-item';
            fileItem.innerHTML = `
                    <div>${files[i].name} (${formatFileSize(files[i].size)})</div>
                    <div class="file-progress">
                        <div class="file-progress-bar" id="fileProgress-${i}"></div>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        <span id="fileSpeed-${i}">é€Ÿåº¦: -- KB/s</span>
                        <span style="margin-left: 10px;" id="fileTimeLeft-${i}">å‰©ä½™æ—¶é—´: --</span>
                    </div>
                `;
            fileListDiv.appendChild(fileItem);
        }
    }

    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
        else return (bytes / 1048576).toFixed(1) + ' MB';
    }

    // å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶
    async function uploadFiles() {
        const files = fileInput.files;
        if (files.length === 0) {
            showResult('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'error');
            return;
        }

        // é‡ç½®UI
        showResult('', '');
        uploadBtn.disabled = true;
        createFileList(files);

        // æ˜¾ç¤ºçŠ¶æ€
        showStatus(`å¼€å§‹ä¸Šä¼  ${files.length} ä¸ªæ–‡ä»¶...`);

        try {
            // éå†æ–‡ä»¶ï¼Œé€ä¸ªä¸Šä¼ 
            let uploadedCount = 0;

            // ç”¨äºå­˜å‚¨æœ€åä¸€ä¸ªæ–‡ä»¶çš„å“åº”
            let finalResponseHtml = '';

            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                // æ›´æ–°çŠ¶æ€
                showStatus(`æ­£åœ¨ä¸Šä¼ æ–‡ä»¶ ${i + 1}/${files.length}: ${file.name}`);

                // ä½¿ç”¨XMLHttpRequestä¸Šä¼ å•ä¸ªæ–‡ä»¶
                const responseHtml = await uploadSingleFile(file, i, (loaded, total) => {
                    // æ›´æ–°æ–‡ä»¶è¿›åº¦
                    const filePercent = Math.round((loaded / total) * 100);
                    updateFileProgress(i, filePercent);
                });

                uploadedCount++;
                finalResponseHtml = responseHtml; // ä¿å­˜æœ€åä¸€ä¸ªæ–‡ä»¶çš„å“åº”
            }

            // æ˜¾ç¤ºæœåŠ¡å™¨å¤„ç†æç¤º
            showStatus('æ‰€æœ‰æ–‡ä»¶ä¼ è¾“å®Œæˆï¼ŒæœåŠ¡å™¨æ­£åœ¨å¤„ç†...');
            processingText.style.display = 'block';

            // æ˜¾ç¤ºç»“æœé¡µé¢
            document.open();
            document.write(finalResponseHtml);
            document.close();

        } catch (error) {
            showResult(`ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
            showStatus('');
            processingText.style.display = 'none';
            uploadBtn.disabled = false;
        }
    }

    // ä¸Šä¼ å•ä¸ªæ–‡ä»¶
    function uploadSingleFile(file, fileIndex, onProgress) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();

            // ä¸Šä¼ å¼€å§‹æ—¶é—´
            let startTime = Date.now();
            // ä¸Šæ¬¡è®¡ç®—é€Ÿåº¦çš„æ—¶é—´
            let lastTime = startTime;
            // ä¸Šæ¬¡ä¸Šä¼ çš„å­—èŠ‚æ•°
            let lastLoaded = 0;
            // å¹³å‡é€Ÿåº¦ï¼ˆKB/sï¼‰
            let averageSpeed = 0;
            // é€Ÿåº¦å†å²è®°å½•ï¼Œç”¨äºå¹³æ»‘è®¡ç®—
            let speedHistory = [];

            // æ›´æ–°é€Ÿåº¦å’Œå‰©ä½™æ—¶é—´æ˜¾ç¤º
            function updateSpeedAndTime(loaded, total) {
                const currentTime = Date.now();
                const elapsed = (currentTime - lastTime) / 1000; // ç§’

                if (elapsed > 0.5) { // æ¯0.5ç§’æ›´æ–°ä¸€æ¬¡
                    const bytesSinceLast = loaded - lastLoaded;
                    const currentSpeed = bytesSinceLast / elapsed / 1024; // KB/s

                    // ä¿å­˜é€Ÿåº¦å†å²ï¼Œç”¨äºå¹³æ»‘è®¡ç®—
                    speedHistory.push(currentSpeed);
                    if (speedHistory.length > 10) {
                        speedHistory.shift(); // åªä¿ç•™æœ€è¿‘10ä¸ªè®°å½•
                    }

                    // è®¡ç®—å¹³å‡é€Ÿåº¦
                    averageSpeed = speedHistory.reduce((sum, speed) => sum + speed, 0) / speedHistory.length;

                    // æ›´æ–°æ˜¾ç¤º
                    const speedSpan = document.getElementById(`fileSpeed-${fileIndex}`);
                    if (speedSpan) {
                        speedSpan.textContent = `é€Ÿåº¦: ${averageSpeed.toFixed(1)} KB/s`;
                    }

                    // è®¡ç®—å‰©ä½™æ—¶é—´
                    if (averageSpeed > 0) {
                        const bytesLeft = total - loaded;
                        const timeLeftSeconds = bytesLeft / (averageSpeed * 1024);
                        const timeLeftFormatted = formatTimeLeft(timeLeftSeconds);

                        const timeLeftSpan = document.getElementById(`fileTimeLeft-${fileIndex}`);
                        if (timeLeftSpan) {
                            timeLeftSpan.textContent = `å‰©ä½™æ—¶é—´: ${timeLeftFormatted}`;
                        }
                    }

                    // æ›´æ–°æ—¶é—´å’ŒåŠ è½½é‡
                    lastTime = currentTime;
                    lastLoaded = loaded;
                }
            }

            // æ ¼å¼åŒ–å‰©ä½™æ—¶é—´
            function formatTimeLeft(seconds) {
                if (seconds < 60) {
                    return `${Math.round(seconds)}ç§’`;
                } else if (seconds < 3600) {
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.round(seconds % 60);
                    return `${minutes}åˆ†${secs}ç§’`;
                } else {
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    return `${hours}å°æ—¶${minutes}åˆ†`;
                }
            }

            // ç›‘å¬ä¸Šä¼ è¿›åº¦
            xhr.upload.addEventListener('progress', function (e) {
                if (e.lengthComputable) {
                    onProgress(e.loaded, e.total);
                    updateSpeedAndTime(e.loaded, e.total);
                }
            });

            // ç›‘å¬ä¸Šä¼ å®Œæˆ
            xhr.addEventListener('load', function () {
                // æ¸…é™¤é€Ÿåº¦å’Œæ—¶é—´æ˜¾ç¤º
                const speedSpan = document.getElementById(`fileSpeed-${fileIndex}`);
                if (speedSpan) {
                    speedSpan.textContent = `é€Ÿåº¦: -- KB/s`;
                }

                const timeLeftSpan = document.getElementById(`fileTimeLeft-${fileIndex}`);
                if (timeLeftSpan) {
                    timeLeftSpan.textContent = `å‰©ä½™æ—¶é—´: --`;
                }

                if (xhr.status === 200) {
                    resolve(xhr.responseText);
                } else {
                    reject(new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${xhr.status}`));
                }
            });

            // ç›‘å¬ä¸Šä¼ é”™è¯¯
            xhr.addEventListener('error', function () {
                // æ¸…é™¤é€Ÿåº¦å’Œæ—¶é—´æ˜¾ç¤º
                const speedSpan = document.getElementById(`fileSpeed-${fileIndex}`);
                if (speedSpan) {
                    speedSpan.textContent = `é€Ÿåº¦: -- KB/s`;
                }

                const timeLeftSpan = document.getElementById(`fileTimeLeft-${fileIndex}`);
                if (timeLeftSpan) {
                    timeLeftSpan.textContent = `å‰©ä½™æ—¶é—´: --`;
                }

                reject(new Error('ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯'));
            });

            // ç›‘å¬ä¸Šä¼ å–æ¶ˆ
            xhr.addEventListener('abort', function () {
                // æ¸…é™¤é€Ÿåº¦å’Œæ—¶é—´æ˜¾ç¤º
                const speedSpan = document.getElementById(`fileSpeed-${fileIndex}`);
                if (speedSpan) {
                    speedSpan.textContent = `é€Ÿåº¦: -- KB/s`;
                }

                const timeLeftSpan = document.getElementById(`fileTimeLeft-${fileIndex}`);
                if (timeLeftSpan) {
                    timeLeftSpan.textContent = `å‰©ä½™æ—¶é—´: --`;
                }

                reject(new Error('ä¸Šä¼ å·²å–æ¶ˆ'));
            });

            // é…ç½®è¯·æ±‚
            xhr.open('POST', '/upload');

            // å‘é€è¯·æ±‚
            const formData = new FormData();
            formData.append('file', file);
            xhr.send(formData);
        });
    }

    // åŠ è½½å…±äº«æ–‡ä»¶åˆ—è¡¨
    async function loadSharedFiles() {
        showStatus('æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...', 'downloadStatus');
        showResult('', '', 'downloadResult');

        try {
            const response = await fetch('/files');
            const data = await response.json();

            if (data.success) {
                const files = data.files;
                if (files.length === 0) {
                    sharedFileListDiv.innerHTML = '<div class="info">æš‚æ— å…±äº«æ–‡ä»¶</div>';
                } else {
                    sharedFileListDiv.innerHTML = '';
                    files.forEach((file, index) => {
                        const fileContainer = document.createElement('div');
                        fileContainer.id = `file-container-${index}`;

                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        console.log(file.name.toLowerCase())
                        // åˆ¤æ–­æ˜¯å¦ä¸º.txtæ–‡ä»¶ä¸”å¤§å°æ˜¯å¦å°äº100KB (102400å­—èŠ‚)
                        const isTxtFile = file.name.toLowerCase().endsWith('.txt');
                        const canPreview = isTxtFile && file.size < 102400;
                        const previewButton = canPreview
                                ? `<button class="preview-btn" onclick="previewFile('${file.id}', '${file.name}', ${index})">é¢„è§ˆ</button>`
                                : '';

                        fileItem.innerHTML = `
                                <div class="file-item-info">
                                    <div class="file-item-name">${file.name}</div>
                                    <div class="file-item-meta">
                                        å¤§å°: ${formatFileSize(file.size)} | æ›´æ–°æ—¶é—´: ${file.mtime}
                                    </div>
                                </div>
                                <div class="file-item-action">
                                    ${previewButton}
                                    <button class="download-btn" onclick="downloadFile('${file.id}')">ä¸‹è½½</button>
                                    <button class="delete-btn" onclick="deleteFile('${file.id}', '${file.name}', 'shared')">åˆ é™¤</button>
                                </div>
                            `;

                        fileContainer.appendChild(fileItem);
                        sharedFileListDiv.appendChild(fileContainer);
                    });
                }
                hideStatus('downloadStatus');
            } else {
                showResult(`åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ${data.message}`, 'error', 'downloadResult');
                hideStatus('downloadStatus');
            }
        } catch (error) {
            showResult(`åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error', 'downloadResult');
            hideStatus('downloadStatus');
        }
    }

    // é€šç”¨ä¸‹è½½æ–‡ä»¶æ–¹æ³•
    function downloadFileGeneric(fileId, fileType = 'shared') {
        const endpoint = fileType === 'received' ? `/download_received/${fileId}` : `/download/${fileId}`;
        const resultElement = fileType === 'received' ? null : 'downloadResult';

        if (resultElement) {
            showResult(`æ­£åœ¨ä¸‹è½½æ–‡ä»¶...`, 'info', resultElement);
        } else {
            showToast('æ­£åœ¨ä¸‹è½½æ–‡ä»¶...', 'info');
        }

        // åˆ›å»ºä¸‹è½½é“¾æ¥å¹¶è§¦å‘ä¸‹è½½
        const downloadLink = document.createElement('a');
        downloadLink.href = endpoint;
        downloadLink.download = fileId;
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        if (resultElement) {
            showResult(`æ–‡ä»¶ä¸‹è½½å·²å¼€å§‹`, 'success', resultElement);
        } else {
            showToast('æ–‡ä»¶ä¸‹è½½å·²å¼€å§‹', 'success');
        }
    }

    // ä¸‹è½½å…±äº«æ–‡ä»¶
    function downloadFile(fileId) {
        downloadFileGeneric(fileId, 'shared');
    }

    // ä¸‹è½½å·²ä¸Šä¼ æ–‡ä»¶
    function downloadReceivedFile(fileId) {
        downloadFileGeneric(fileId, 'received');
    }

    // é€šç”¨é¢„è§ˆæ–‡ä»¶æ–¹æ³•
    async function previewFileGeneric(fileId, fileName, index, fileType = 'shared') {
        // å…³é—­æ‰€æœ‰å…¶ä»–é¢„è§ˆ
        const allPreviews = document.querySelectorAll('.file-item-preview');
        allPreviews.forEach(preview => preview.remove());

        const containerPrefix = fileType === 'received' ? 'received-file-container' : 'file-container';
        const previewPrefix = fileType === 'received' ? 'preview-received' : 'preview';
        const contentPrefix = fileType === 'received' ? 'preview-received-content' : 'preview-content';
        const endpoint = fileType === 'received' ? `/preview_received/${fileId}` : `/preview/${fileId}`;
        const closeFunc = fileType === 'received' ? 'closeReceivedPreview' : 'closePreview';
        const copyFunc = fileType === 'received' ? 'copyReceivedPreviewContent' : 'copyPreviewContent';

        const fileContainer = document.getElementById(`${containerPrefix}-${index}`);
        if (!fileContainer) return;

        // åˆ›å»ºé¢„è§ˆå®¹å™¨
        const previewDiv = document.createElement('div');
        previewDiv.className = 'file-item-preview';
        previewDiv.id = `${previewPrefix}-${index}`;
        previewDiv.innerHTML = `
            <button class="preview-close" onclick="${closeFunc}(${index})" title="å…³é—­é¢„è§ˆ">Ã—</button>
            <div class="preview-header">
                <div class="preview-title">æ–‡ä»¶é¢„è§ˆ: ${fileName}</div>
                <button class="preview-copy" onclick="${copyFunc}(${index})">å¤åˆ¶å†…å®¹</button>
            </div>
            <div class="preview-content" id="${contentPrefix}-${index}">
                <div class="preview-loading">æ­£åœ¨åŠ è½½æ–‡ä»¶å†…å®¹...</div>
            </div>
        `;

        fileContainer.appendChild(previewDiv);

        // æ»šåŠ¨åˆ°é¢„è§ˆåŒºåŸŸ
        previewDiv.scrollIntoView({behavior: 'smooth', block: 'nearest'});

        try {
            // è¯·æ±‚æ–‡ä»¶å†…å®¹
            const response = await fetch(endpoint);
            const data = await response.json();

            const previewContent = document.getElementById(`${contentPrefix}-${index}`);
            if (previewContent) {
                if (data.success) {
                    // æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
                    previewContent.textContent = data.content;
                } else {
                    previewContent.innerHTML = `<div style="color: #f44336;">é¢„è§ˆå¤±è´¥: ${data.message}</div>`;
                }
            }
        } catch (error) {
            const previewContent = document.getElementById(`${contentPrefix}-${index}`);
            if (previewContent) {
                previewContent.innerHTML = `<div style="color: #f44336;">é¢„è§ˆå¤±è´¥: ${error.message}</div>`;
            }
        }
    }

    // é¢„è§ˆå…±äº«æ–‡ä»¶
    async function previewFile(fileId, fileName, index) {
        await previewFileGeneric(fileId, fileName, index, 'shared');
    }

    // é¢„è§ˆå·²ä¸Šä¼ æ–‡ä»¶
    async function previewReceivedFile(fileId, fileName, index) {
        await previewFileGeneric(fileId, fileName, index, 'received');
    }

    // é€šç”¨å…³é—­é¢„è§ˆæ–¹æ³•
    function closePreviewGeneric(index, fileType = 'shared') {
        const previewPrefix = fileType === 'received' ? 'preview-received' : 'preview';
        const previewDiv = document.getElementById(`${previewPrefix}-${index}`);
        if (previewDiv) {
            previewDiv.remove();
        }
    }

    // å…³é—­å…±äº«æ–‡ä»¶é¢„è§ˆ
    function closePreview(index) {
        closePreviewGeneric(index, 'shared');
    }

    // å…³é—­å·²ä¸Šä¼ æ–‡ä»¶é¢„è§ˆ
    function closeReceivedPreview(index) {
        closePreviewGeneric(index, 'received');
    }

    // é€šç”¨å¤åˆ¶é¢„è§ˆå†…å®¹æ–¹æ³•
    async function copyPreviewContentGeneric(index, fileType = 'shared') {
        const contentPrefix = fileType === 'received' ? 'preview-received-content' : 'preview-content';
        const previewContent = document.getElementById(`${contentPrefix}-${index}`);

        if (!previewContent) {
            showToast('é¢„è§ˆå†…å®¹ä¸å­˜åœ¨', 'error');
            return;
        }

        const text = previewContent.textContent;

        if (!text || text.includes('æ­£åœ¨åŠ è½½') || text.includes('é¢„è§ˆå¤±è´¥')) {
            showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
            return;
        }

        try {
            // ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                await navigator.clipboard.writeText(text);
                showToast('âœ… å¤åˆ¶æˆåŠŸ', 'success');
            } else {
                // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();

                try {
                    document.execCommand('copy');
                    showToast('âœ… å¤åˆ¶æˆåŠŸ', 'success');
                } catch (err) {
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                }

                document.body.removeChild(textarea);
            }
        } catch (error) {
            showToast('å¤åˆ¶å¤±è´¥: ' + error.message, 'error');
        }
    }

    // å¤åˆ¶å…±äº«æ–‡ä»¶é¢„è§ˆå†…å®¹
    async function copyPreviewContent(index) {
        await copyPreviewContentGeneric(index, 'shared');
    }

    // å¤åˆ¶å·²ä¸Šä¼ æ–‡ä»¶é¢„è§ˆå†…å®¹
    async function copyReceivedPreviewContent(index) {
        await copyPreviewContentGeneric(index, 'received');
    }

    // åˆ é™¤æ–‡ä»¶ï¼ˆå¸¦ç¡®è®¤å¯¹è¯æ¡†ï¼‰
    async function deleteFile(fileId, fileName, fileType) {
        // å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
        const confirmDelete = confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${fileName}" å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`);

        if (!confirmDelete) {
            return; // ç”¨æˆ·å–æ¶ˆåˆ é™¤
        }

        try {
            const endpoint = fileType === 'received'
                ? `/delete_received/${encodeURIComponent(fileId)}`
                : `/delete_shared/${encodeURIComponent(fileId)}`;

            const response = await fetch(endpoint, {
                method: 'POST'
            });

            const data = await response.json();

            if (data.success) {
                showToast(`âœ… æ–‡ä»¶ "${fileName}" å·²åˆ é™¤`, 'success');

                // åˆ·æ–°å¯¹åº”çš„æ–‡ä»¶åˆ—è¡¨
                if (fileType === 'received') {
                    loadReceivedFiles();
                } else {
                    loadSharedFiles();
                }
            } else {
                showToast(`âŒ åˆ é™¤å¤±è´¥: ${data.message}`, 'error');
            }
        } catch (error) {
            showToast(`âŒ åˆ é™¤å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // ä¸Šä¼ æ–‡æœ¬
    async function uploadText() {
        const text = textInput.value.trim();

        if (!text) {
            showResult('è¯·è¾“å…¥æ–‡æœ¬å†…å®¹', 'error', 'textResult');
            return;
        }

        // è·å–æ–‡ä»¶å
        let fileName = textFileName.value.trim();
        if (!fileName) {
            // å¦‚æœæ²¡æœ‰è¾“å…¥æ–‡ä»¶åï¼Œä½¿ç”¨æ—¶é—´æˆ³
            const now = new Date();
            fileName = `text_${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;
        }

        // ç§»é™¤æ–‡ä»¶åä¸­çš„éæ³•å­—ç¬¦
        fileName = fileName.replace(/[<>:"/\\|?*]/g, '');

        // ç¡®ä¿æ–‡ä»¶åä¸ä¸ºç©º
        if (!fileName) {
            fileName = 'text_file';
        }

        // æ·»åŠ  .txt åç¼€ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
        if (!fileName.endsWith('.txt')) {
            fileName += '.txt';
        }

        // ç¦ç”¨æŒ‰é’®
        uploadTextBtn.disabled = true;
        showStatus('æ­£åœ¨ä¸Šä¼ æ–‡æœ¬...', 'textStatus');
        showResult('', '', 'textResult');

        try {
            // åˆ›å»º FormData
            const formData = new FormData();
            const blob = new Blob([text], {type: 'text/plain'});
            formData.append('text', text);
            formData.append('filename', fileName);

            // å‘é€è¯·æ±‚
            const response = await fetch('/upload_text', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                showResult(`âœ… æ–‡æœ¬å·²ä¿å­˜ä¸º: ${data.filename}<br>å¤§å°: ${formatFileSize(data.size)}<br><br>æ–‡æœ¬å†…å®¹å·²ä¿ç•™ï¼Œå¯ç»§ç»­ç¼–è¾‘æˆ–ä¸Šä¼ æ–°çš„æ–‡æœ¬`, 'success', 'textResult');
                // æ³¨æ„ï¼šä¸æ¸…ç©ºæ–‡æœ¬æ¡†ï¼Œä¿æŒå†…å®¹
            } else {
                showResult(`ä¸Šä¼ å¤±è´¥: ${data.message}`, 'error', 'textResult');
            }

            hideStatus('textStatus');
            uploadTextBtn.disabled = false;

        } catch (error) {
            showResult(`ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error', 'textResult');
            hideStatus('textStatus');
            uploadTextBtn.disabled = false;
        }
    }

    // åŠ è½½å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ï¼ˆç›´æ¥æ˜¾ç¤ºå…¨éƒ¨ï¼‰
    async function loadReceivedFiles() {
        try {
            const response = await fetch('/received_files');
            const data = await response.json();

            const receivedFileListDiv = document.getElementById('receivedFileList');

            if (data.success) {
                const receivedFiles = data.files;
                if (receivedFiles.length === 0) {
                    receivedFileListDiv.innerHTML = '<div class="info">æš‚æ— å·²ä¸Šä¼ æ–‡ä»¶</div>';
                } else {
                    receivedFileListDiv.innerHTML = '';
                    receivedFiles.forEach((file, index) => {
                        const fileContainer = document.createElement('div');
                        fileContainer.id = `received-file-container-${index}`;

                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';

                        // åˆ¤æ–­æ˜¯å¦ä¸º.txtæ–‡ä»¶ä¸”å¤§å°æ˜¯å¦å°äº100KB
                        const isTxtFile = file.name.toLowerCase().endsWith('.txt');
                        const canPreview = isTxtFile && file.size < 102400;
                        const previewButton = canPreview
                            ? `<button class="preview-btn" onclick="previewReceivedFile('${file.id}', '${file.name}', ${index})">é¢„è§ˆ</button>`
                            : '';

                        fileItem.innerHTML = `
                            <div class="file-item-info">
                                <div class="file-item-name">${file.name}</div>
                                <div class="file-item-meta">
                                    å¤§å°: ${formatFileSize(file.size)} | ä¸Šä¼ æ—¶é—´: ${file.mtime}
                                </div>
                            </div>
                            <div class="file-item-action">
                                ${previewButton}
                                <button class="download-btn" onclick="downloadReceivedFile('${file.id}')">ä¸‹è½½</button>
                                <button class="delete-btn" onclick="deleteFile('${file.id}', '${file.name}', 'received')">åˆ é™¤</button>
                            </div>
                        `;

                        fileContainer.appendChild(fileItem);
                        receivedFileListDiv.appendChild(fileContainer);
                    });
                }
            } else {
                showToast(`åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ${data.message}`, 'error');
            }
        } catch (error) {
            showToast(`åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // é¡µé¢åŠ è½½å®Œæˆåï¼ŒåŠ è½½æ–‡ä»¶åˆ—è¡¨
    document.addEventListener('DOMContentLoaded', function () {
        // åˆå§‹åŒ–æ—¶åŠ è½½å…±äº«æ–‡ä»¶åˆ—è¡¨å’Œå·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
        loadSharedFiles();
        loadReceivedFiles();
    });
</script>
</body>
</html>
